{
  "hash": "82cbde39888574d38a139bbc98add7ef",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Séance 2 : Data Mining - Analyse descriptive {.unnumbered}\n\n## 1. Quelles questions intéressantes pour une \"fouille de données\" sur la  base des RP ? {#c05-Questions-fouille-donnees}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Chargement des librairies\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(gt)\nlibrary(learnrbook)\n\n# Chargement des tables\nRP_final <- readRDS(file = \"data/RP_final.Rdata\")\nmeta <- readRDS(file = \"data/meta.Rdata\")\n```\n:::\n\n\nQuelles sont les questions intéressantes que l'on peut se poser ? Qu'est-ce qu'on va pouvoir mettre en évidence à partir de ces données ?  \n\nD'abord, on peut caractériser la population de Paris et sa petite couronne selon des variables socio-démographiques (sexe, âge, diplôme, statut conjugal, nombre d'enfants, ...) et d'emploi (statut d'activité, PCS, condition d'emploi - contrat, temps de travail -, secteur d'activité, ...). Ensuite, on peut décrire les logements de Paris et sa petite couronne, selon le type (appartement, maison, HLM, ...), la superficie, le nombre de pièces, le nombre de personnes y habitant, le statut d'occupation (propriétaire, locataire, ...), l'ancienneté d'occupation. Enifn, on peut décrire plus précisément les pièces du logement en termes de confort (baignoire / douche, salle climatisée, moyen de chauffage), ainsi que les parties communes de l'immeuble (ascenseur, place de stationnement). Enfin, on pourrait étudier les caractéristiques des occupants de ces logements, et en premier lieu ici ce que l'Insee appelle la \"personne de référence du ménage\". Par ailleurs, toutes ces analyses peuvent être réalisées en comparant les différentes communes de Paris et sa petite couronne, ou à un niveau géographique plus fin par quartiers, arrondissements ou encore IRIS.   \n\nPour manipuler cette base et répondre à quelques-unes de ces questions, nous allons nous concentrer sur la commune de Paris, et allons chercher à reproduire des statistiques publiées sur le site de l'Insee. Nous produirons principalement, lors de cette séance, des tableaux de statistiques, l'analyse graphique fera en effet l'objet de la séance suivante car elle nécessite la présentation détaillée de la \"grammaire\" **`Ggplot`**.  \n  \nAvant cela, si les tables de données (\"RP_final\" et \"meta\") ne sont plus dans votre environnement local, il faut de nouveau les importer à partir de l'enregistrement précédemment effectué dans le dossier 'data' de votre projet. Pour cela, il faut utiliser la fonction `readRDS()`, comme ci-dessous :\n\n  \n\n### 1.1 Caractéristiques de la population résidant à Paris \nSur le site de l'Insee, vous pouvez trouver les statistiques générales sur les individus à Paris en 2019 <a href=\"https://www.insee.fr/fr/statistiques/6455183?sommaire=6455209&geo=DEP-75\" target=\"_blank\">ici</a> et <a href=\"https://www.insee.fr/fr/statistiques/6455302?sommaire=6455322&geo=DEP-75\" target=\"_blank\">là</a>.  \n\nComme déjà vu lors de la 1ère séance, l'application de la pondération pour avoir des statistiques représentatives de la population peut être utilisée à l'intérieur de la fonction `count()` avec l'argument `wt=`. Cela nous donnera le nombre d'individus concernés par la caractéristique étudiée (par défaut, la variable créée s'appelle \"n\", on peut la renommer dans une étape ultérieure avec la fonction `rename()`). Souvent, on souhaite aussi avoir les pourcentages, on peut alors créer une variable rapportant le nombre de chaque catégorie sur le nombre total d'individus, avec la fonction `prop.table()` utilisée dans la fonction `mutate()`. Le package **`janitor`** peut permettre enfin d'ajouter une ligne totale (ou une colonne totale selon ce qu'on souhaite faire) avec la fonction `adorn_totals()`, argument \"row\" pour avoir le total en ligne ou \"col\" pour l'avoir en colonne. Des fonctions supplémentaires liées au package **`gt()`** peuvent ensuite être utilisées pour mettre en forme le tableau : `fmt_number()`, `tab_header()` ou encore `tab_source_note()`.      \n \nA partir de ces indications, afficher le tableau suivant à partir d'un code utilisant le langage **tidyverse** et en une seule procédure (sans créer de table dans votre environnement) :\n \n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'janitor' a été compilé avec la version R 4.3.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttachement du package : 'janitor'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLes objets suivants sont masqués depuis 'package:stats':\n\n    chisq.test, fisher.test\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"xrtahaopri\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#xrtahaopri table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#xrtahaopri thead, #xrtahaopri tbody, #xrtahaopri tfoot, #xrtahaopri tr, #xrtahaopri td, #xrtahaopri th {\n  border-style: none;\n}\n\n#xrtahaopri p {\n  margin: 0;\n  padding: 0;\n}\n\n#xrtahaopri .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#xrtahaopri .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#xrtahaopri .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#xrtahaopri .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#xrtahaopri .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#xrtahaopri .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#xrtahaopri .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#xrtahaopri .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#xrtahaopri .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#xrtahaopri .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#xrtahaopri .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#xrtahaopri .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#xrtahaopri .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#xrtahaopri .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#xrtahaopri .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xrtahaopri .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#xrtahaopri .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#xrtahaopri .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#xrtahaopri .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xrtahaopri .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#xrtahaopri .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xrtahaopri .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#xrtahaopri .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xrtahaopri .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xrtahaopri .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xrtahaopri .gt_left {\n  text-align: left;\n}\n\n#xrtahaopri .gt_center {\n  text-align: center;\n}\n\n#xrtahaopri .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#xrtahaopri .gt_font_normal {\n  font-weight: normal;\n}\n\n#xrtahaopri .gt_font_bold {\n  font-weight: bold;\n}\n\n#xrtahaopri .gt_font_italic {\n  font-style: italic;\n}\n\n#xrtahaopri .gt_super {\n  font-size: 65%;\n}\n\n#xrtahaopri .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#xrtahaopri .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#xrtahaopri .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#xrtahaopri .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#xrtahaopri .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#xrtahaopri .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#xrtahaopri .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#xrtahaopri .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#xrtahaopri div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"3\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Population par sexe en 2019</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Sexe\">Sexe</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Effectif\">Effectif</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Pourcentage\">Pourcentage</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Sexe\" class=\"gt_row gt_left\">Femmes</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 146 436</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">52.9</td></tr>\n    <tr><td headers=\"Sexe\" class=\"gt_row gt_left\">Hommes</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 019 195</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">47.1</td></tr>\n    <tr><td headers=\"Sexe\" class=\"gt_row gt_left\">Total</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">2 165 631</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">100.0</td></tr>\n  </tbody>\n  <tfoot>\n    <tr class=\"gt_sourcenotes\">\n      <td class=\"gt_sourcenote\" colspan=\"3\">Source : Insee, RP 2019 ; Champ : Paris.</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n \n <div class=\"solution-exo\">\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(gt)\nRP_final %>% \n  filter(DEPT == \"75\") %>% \n  mutate(SEXE=case_when(SEXE==\"1\" ~ \"Hommes\", SEXE==\"2\" ~ \"Femmes\")) %>% \n  count(SEXE, wt=IPONDI) %>% \n  mutate(Pourcentage=round(prop.table(n)*100, 1)) %>% \n  adorn_totals(\"row\") %>% \n  rename(Effectif=n, 'Sexe'=SEXE) %>% \n  gt() %>% \n  fmt_number(columns = 2, sep_mark = \" \", decimals = 0) %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\") %>% \n  tab_header(title = \"Population par sexe en 2019\")\n```\n:::\n\n</div>\n\\fi\nIl y a plus de femmes habitant Paris en 2019, environ 53%.     \n\n\nCherchons maintenant la répartition de la population parisienne par type d'activité : quelle est la proportion d'actifs ayant un emploi par rapport à la part des chômeurs ou encore des retraités ? Attention au champ sur lequel porte ces statistiques (lire le titre du tableau pour cela...).    \n \n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"joifugcayq\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#joifugcayq table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#joifugcayq thead, #joifugcayq tbody, #joifugcayq tfoot, #joifugcayq tr, #joifugcayq td, #joifugcayq th {\n  border-style: none;\n}\n\n#joifugcayq p {\n  margin: 0;\n  padding: 0;\n}\n\n#joifugcayq .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#joifugcayq .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#joifugcayq .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#joifugcayq .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#joifugcayq .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#joifugcayq .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#joifugcayq .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#joifugcayq .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#joifugcayq .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#joifugcayq .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#joifugcayq .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#joifugcayq .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#joifugcayq .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#joifugcayq .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#joifugcayq .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#joifugcayq .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#joifugcayq .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#joifugcayq .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#joifugcayq .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#joifugcayq .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#joifugcayq .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#joifugcayq .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#joifugcayq .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#joifugcayq .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#joifugcayq .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#joifugcayq .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#joifugcayq .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#joifugcayq .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#joifugcayq .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#joifugcayq .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#joifugcayq .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#joifugcayq .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#joifugcayq .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#joifugcayq .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#joifugcayq .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#joifugcayq .gt_left {\n  text-align: left;\n}\n\n#joifugcayq .gt_center {\n  text-align: center;\n}\n\n#joifugcayq .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#joifugcayq .gt_font_normal {\n  font-weight: normal;\n}\n\n#joifugcayq .gt_font_bold {\n  font-weight: bold;\n}\n\n#joifugcayq .gt_font_italic {\n  font-style: italic;\n}\n\n#joifugcayq .gt_super {\n  font-size: 65%;\n}\n\n#joifugcayq .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#joifugcayq .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#joifugcayq .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#joifugcayq .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#joifugcayq .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#joifugcayq .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#joifugcayq .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#joifugcayq .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#joifugcayq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"3\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Population des 15-64 ans par type d'activité en 2019</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Type-d'activité\">Type d'activité</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Effectif\">Effectif</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Pourcentage\">Pourcentage</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Actifs ayant un emploi</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 042 588</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">69.3</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Chômeurs</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">135 014</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">9.0</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Élèves, étudiants et stagiaires non rémunérés</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">192 205</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">12.8</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Retraités ou préretraités</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">38 512</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">2.6</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Autres inactifs</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">95 944</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">6.4</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Total</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 504 263</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">100.1</td></tr>\n  </tbody>\n  <tfoot>\n    <tr class=\"gt_sourcenotes\">\n      <td class=\"gt_sourcenote\" colspan=\"3\">Source : Insee, RP 2019 ; Champ : Paris.</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n \n <div class=\"solution-exo\">\n\n::: {.cell}\n\n```{.r .cell-code}\nRP_final %>% \n  filter(DEPT == \"75\" & !AGEREVQ %in% c(\"0\", \"5\", \"10\", \"65\", \"70\", \"75\", \"80\", \"85\", \"90\", \"95\", \n                                        \"100\", \"105\", \"110\", \"115\", \"120\")) %>% \n  mutate(TACT=case_when(TACT == \"11\" ~ \"Actifs ayant un emploi\",\n                             TACT == \"12\" ~ \"Chômeurs\",\n                             TACT == \"22\" ~ \"Élèves, étudiants et stagiaires non rémunérés\",\n                             TACT == \"21\" ~ \"Retraités ou préretraités\",\n                             TRUE ~ \"Autres inactifs\"),\n         TACT=fct_relevel(TACT, c(\"Actifs ayant un emploi\", \"Chômeurs\",\n                                            \"Élèves, étudiants et stagiaires non rémunérés\", \n                                            \"Retraités ou préretraités\", \"Autres inactifs\"))) %>% \n  count(TACT, wt=IPONDI) %>% \n  mutate(Pourcentage=round(prop.table(n)*100,1)) %>% \n  adorn_totals(\"row\") %>% \n  rename(Effectif=n, \"Type d'activité\"=TACT) %>% \n  gt() %>% \n  fmt_number(columns = 2, sep_mark = \" \", decimals = 0) %>% \n  tab_header(title = \"Population des 15-64 ans par type d'activité en 2019\") %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\")\n```\n:::\n\n</div>\n\\fi\nEn 2019, la population parisienne comportait plus de 78% d'actifs dont 69% ayant un emploi et 9% au chômage, le taux de chômage à Paris était donc de 11,5% (135014/(1042588+135014))*100). La part des étudiants ou autres élèves était plus élevée que celle des retraités (ou préretaités) : 12,8% contre 2,6%.    \n   \n\n### 1.2 Caractéristiques de la population active résidant à Paris\nMaintenant, affichons les deux dernières colonnes ('2019' et 'dont actifs ayant un emploi') de ce tableau tiré du site de l'Insee, en mettant la ligne \"Ensemble\" plutôt en fin de tableau (ces 2 usages sont possibles, question de préférence...). Attention encore une fois au champ de ce tableau... Pour cela, on va : \n\n- récupérer les libellés des modalités de la variable CS1 à partir du fichier 'meta', en créant 2 vecteurs correspondant aux modalités pour le 1er et aux libellés pour le 2nd, puis en créant une variable 'CS1_moda' à partir de ces vecteurs ;\n- créer une 1ère table qu'on appellera 'col2' qui comportera la 1ère colonne avec les intitulés des PCS et la colonne '2019', attention, il y a une modalité qui ne nous intéresse pas car non affiché dans le tableau de l'Insee, il faudra supprimer cette ligne (vous pouvez utiliser pour cela la fonction `slice()`) ; \n- créer une 2ème table qu'on appellera 'col3' qui comportera la 1ère colonne avec les intitulés des PCS et la colonne 'dont actifs ayant un emploi', attention le champ n'est donc pas tout à fait le même ;\n- joindre ces deux tables et appliquer les fonctions `gt()` et suivantes pour la mise en forme du tableau final.\n\n![ ](images/Tab. Insee 1.png)\n <div class=\"solution-exo\">\n\n::: {.cell}\n\n```{.r .cell-code}\n# On va récupérer les libellés des modalités de la variable CS1 à partir du \n#  fichier meta :\nlevels_CS1 <- meta[meta$COD_VAR==\"CS1\", ]$COD_MOD\nlabels_CS1 <- meta[meta$COD_VAR==\"CS1\", ]$LIB_MOD\nRP_final <- RP_final %>% mutate(CS1_moda=factor(CS1, levels = levels_CS1, \n                                                labels = labels_CS1))\n\ncol2 <- RP_final %>% \n  filter(DEPT == \"75\" & !AGEREVQ %in% c(\"0\", \"5\", \"10\", \"65\", \"70\", \"75\", \"80\",\n                                        \"85\", \"90\", \"95\", \"100\", \"105\", \"110\",\n                                        \"115\", \"120\") &\n           TACT %in% c(\"11\", \"12\")) %>% \n  count(CS1_moda, wt=IPONDI) %>% \n  mutate(n=round(n)) %>% \n  rename('2019'=n, 'PCS'=CS1_moda) %>% \n  adorn_totals(\"row\") %>% \n  slice(-7)\n\ncol3 <- RP_final %>% \n  filter(DEPT == \"75\" & !AGEREVQ %in% c(\"0\", \"5\", \"10\", \"65\", \"70\", \"75\", \"80\",\n                                        \"85\", \"90\", \"95\", \"100\", \"105\", \"110\", \n                                        \"115\", \"120\") &\n           TACT %in% c(\"11\")) %>% \n  count(CS1_moda, wt=IPONDI) %>% \n  mutate(n=round(n)) %>% \n  rename('dont actifs ayant un emploi'=n, 'PCS'=CS1_moda) %>% \n  adorn_totals(\"row\")\n\ncol2 %>% left_join(col3) %>%  \n  gt()  %>% \n  fmt_number(columns = c(2,3), sep_mark = \" \", decimals = 0) %>% \n  tab_header(title = \"Population active de 15-64 ans selon la \n             catégorie socioprofessionnelle en 2019\") %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\")\n\n# On supprime les tableaux intermédiaires\nrm(col2, col3)\n```\n:::\n\n</div>\n\\fi\n\nA Paris, la population active comprend en 2019 plus de 500 000 personnes appartenant à la catégorie \"cadres et professions intellectuelles supérieures\", des 2 colonnes on peut en déduire qu'il y a environ 31 000 personnes relevant de cette PCS qui sont au chômage. Les cadres sont suivis des professions intermédiaires (plus de 260 000 actifs) et des employés (quasi 220 000). Il y a très peu d'agriculteurs exploitants, ce qui semble assez logique sur le territoire de Paris !   \n    \n  \n### 1.3 Caractéristiques des logements parisiens\nEnfin, pour donner un exemple sur l'étude des caractéristiques des logements parisiens, essayons de même de reproduire le tableau de l'Insee ci-dessous. Souvenez-vous que cette base a plusieurs unités statistiques/niveaux : individus, logements/ménages, etc. Il faut donc faire attention : \n\n- au champ du tableau donc les filtres à utiliser ici ;\n- à avoir d'abord les moyennes sur ces deux types de logements, donc uiliser à la suite les fonctions `group_by()` et `summarise()` ;\n- à ajouter ensuite une ligne sur l'ensemble des résidences principales avec la fonction `bind_rows()` ; \n- à changer les dénominations des colonnes et des modalités, avec les fonctions du package `gt()` comme `cols_label()` ou `text_case_match()`.\n\n![ ](images/Tab. Insee 2.png)\n\n<div class=\"solution-exo\">\n\n::: {.cell}\n\n```{.r .cell-code}\nRP_final %>% \n  filter(DEPT == \"75\" & LPRM==\"1\" & CATL==\"1\" & TYPL %in% c(\"1\", \"2\")) %>% \n  group_by(TYPL) %>%\n  summarise(Moy_pieces = weighted.mean(as.numeric(as.character(NBPI)), \n                                       IPONDI, na.rm=T)) %>%\n  bind_rows(summarise(TYPL = \"Ensemble des résidences principales\", \n                      RP_final[RP_final$DEPT == \"75\" & RP_final$LPRM==\"1\" & \n                                 RP_final$CATL == \"1\" & RP_final$TYPL %in% c(\"1\", \"2\"), ], \n                      Moy_pieces = weighted.mean(as.numeric(as.character(NBPI)), \n                                                 IPONDI, na.rm=T))) %>%\n  gt() %>% \n  fmt_number(columns = 2, dec_mark = \",\", decimals = 1) %>% \n  cols_label(TYPL=\"Type de logement\", Moy_pieces=\"2019\") %>% \n  text_case_match(\"1\" ~ \"Maison\", \"2\" ~ (\"Appartement\")) %>% \n  tab_header(title = \"Nombre moyen de pièces des résidences principales\") %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\")\n```\n:::\n\n</div>\n\\fi\n  \n  \nAinsi, si l'on veut créer des tableaux de répartition à une seule variable, on peut utiliser ces procédures qui se structurent toujours de la même façon. Au lieu de faire un copié-collé du code et de changer le nom des variables, autrement dit pour systématiser nos procédures, une astuce est de créer ses propres fonctions. C'est ce que nous allons étudier maintenant.   \n\n\n\n\n\n## 2. Systématiser nos procédures : construire une fonction {#c06-Fonctions}\n\nPour ré-utiliser un code de façon plus automatique, créer des fonctions est très utile (et on peut même les stocker dans un fichier `.r` pour les réutiliser plus tard pour une autre étude).   \n\n\n### 2.1 Principes généraux d'une fonction\nL'idée est qu'à partir d'un bloc d'instructions ou de lignes de codes, on l'intègre dans une fonction qui portera un nom et qui pourra être appliquée sur les paramètres que l'on veut (table/objet différent, variables différentes) et qui nous retournera une valeur en sortie (qu'il faut préciser donc). Par exemple : \n\n::: {.cell}\n\n```{.r .cell-code}\n# Exemple fonction avec 3 arguments\nnom_fonction <- function(data, var1, var2) {\n  \n  expression...  # Ce que la fonction fait\n  \n  return()  # Optionnel, mais la plupart du temps utilisé (!), \n               # pour sortir le résultat de la fonction\n  \n}\n\n# L'appel de la fonction devra ainsi préciser la table de données sur laquelle \n# l'appliquer et les autres arguments : \nnom_fonction(data = nom_de_ma_table , var1 = nom_de_ma_variable1,  \n             var2 = nom_de_ma_variable2)\n\n# De plus, on pourra créer un nouvel objet (ici \"tab_var\") pour stocker la table \n# qui est en valeur de sortie de la fonction : \ntab_var <- nom_fonction(data = nom_de_ma_table , var1 = nom_de_ma_variable1,\n                        var2 = nom_de_ma_variable2)\n```\n:::\n\nLes arguments doivent donc être précisés en entrée de notre fonction, si on ne les précise pas cela nous retournera une erreur... à moins que l'on ait spécifié des valeurs par défaut (ce qui peut être utile si on utilise souvent les mêmes paramètres, par exemple la même base de données) ; il peut y avoir autant d'arguments que l'on souhaite.  \n\nSi l'on utilise le langage tidyverse, il faut connaître quelques petits \"trucs\" pour écrire une fonction. Le schéma suivant réalisé par Julien Barnier du CNRS nous sera très utile.  \n\n![Pour une fonction utilisant le langage tidyverse](images/Schéma tidyverse functions_Julien Barnier.jpg)\n*Source* : Julien Barnier, <a href=\"https://twitter.com/lapply/status/1493908215796535296?s=20&t=p4aYIEV4GsGS3TGftPa0Nw\" target=\"_blank\">https://twitter.com/lapply/status/1493908215796535296?s=20&t=p4aYIEV4GsGS3TGftPa0Nw</a>.  \n   \n\nVous trouverez également des informations utiles <a href=\"https://thinkr.fr/comment-creer-des-fonctions-dans-le-tidyverse-avec-la-tidyeval-et-le-stash-stash/\" target=\"_blank\">ici</a> ou <a href=\"https://www.vishalkatti.com/posts/2021-07-17-programmingwithdplyr/\" target=\"_blank\">là</a>.  \n\n\n### 2.2 Exemples de fonctions\nOn peut d'abord créer une fonction reprenant le code de la section précédente pour la construction de tableau. On l'appelle `tableau`, et on lui donne comme arguments \"data\", \"filtre_dept\", \"var_quali\", \"pond\" et \"nom_var_quali\". \n\nDans le langage tidyverse, au sein d'une fonction, il faut appeler une variable avec des doubles-accolades `{{  }}`.  \n\nSi l'on utilise une fonction `summarise()`, une autre subtilité à connaître est que cette syntaxe `summarise({{ nom_var }} = mean({{ var }}, na.rm=TRUE))` ne sera pas reconnue, car il faut indiquer non pas un `=` mais un `:=` pour que la fonction puisse être lue lorsque le nom donné à la variable est de type caractère ou \"string\".    \n\nEnfin, il ne faut pas oublier de retourner un objet en sortie avec `return()`.   \n   \n   \nEssayez donc de créer une fonction `tableau()`, reprenant le premier code de la section précédente et remise ci-dessous pour information : \n\n::: {.cell}\n\n```{.r .cell-code}\nRP_final %>% \n  filter(DEPT == \"75\") %>% \n  mutate(SEXE_moda=case_when(SEXE==\"1\" ~ \"Hommes\", SEXE==\"2\" ~ \"Femmes\")) %>% #ne pas mettre cette ligne dans la fonction\n  count(SEXE_moda, wt=IPONDI) %>% \n  mutate(Pourcentage=round(prop.table(n)*100, 1)) %>% \n  adorn_totals(\"row\") %>% \n  rename(Effectif=n, 'Sexe'=SEXE_moda) %>% \n  gt() %>% \n  fmt_number(columns = 2, sep_mark = \" \", decimals = 0) %>% \n  tab_header(title = \"Population par sexe en 2019\") %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\")\n```\n:::\n\n\n<div class=\"solution-exo\">\n\n::: {.cell}\n\n```{.r .cell-code}\ntableau <- function(data, filtre_dept, var_quali, pond=IPONDI, nom_var_quali){\n  \n  tab <- data %>% \n    filter(DEPT == filtre_dept) %>% \n    count({{ var_quali }}, wt={{ pond }}) %>% \n    mutate(Pourcentage=round(prop.table(n)*100, 1)) %>% \n    adorn_totals(\"row\") %>% \n    rename(Effectif=n, {{nom_var_quali}}:={{ var_quali }}) \n  \n  return(tab)\n  \n}\n```\n:::\n\n</div>\n\\fi\n\nOn peut vérifier qu'on obtient bien la même chose :\n\n::: {.cell}\n\n```{.r .cell-code}\nRP_final %>% \n  mutate(SEXE_moda=case_when(SEXE==\"1\" ~ \"Hommes\", SEXE==\"2\" ~ \"Femmes\")) %>% \n  tableau(filtre_dept=\"75\", var_quali=SEXE_moda, nom_var_quali=\"Sexe\") %>% \n  gt() %>% \n  fmt_number(columns = 2, sep_mark = \" \", decimals = 0) %>% \n  tab_header(title = \"Population par sexe en 2019\") %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"qvdswwztfw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#qvdswwztfw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#qvdswwztfw thead, #qvdswwztfw tbody, #qvdswwztfw tfoot, #qvdswwztfw tr, #qvdswwztfw td, #qvdswwztfw th {\n  border-style: none;\n}\n\n#qvdswwztfw p {\n  margin: 0;\n  padding: 0;\n}\n\n#qvdswwztfw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#qvdswwztfw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#qvdswwztfw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#qvdswwztfw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#qvdswwztfw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#qvdswwztfw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#qvdswwztfw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#qvdswwztfw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#qvdswwztfw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#qvdswwztfw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#qvdswwztfw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qvdswwztfw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#qvdswwztfw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#qvdswwztfw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#qvdswwztfw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qvdswwztfw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#qvdswwztfw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#qvdswwztfw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#qvdswwztfw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qvdswwztfw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#qvdswwztfw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qvdswwztfw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#qvdswwztfw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qvdswwztfw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qvdswwztfw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qvdswwztfw .gt_left {\n  text-align: left;\n}\n\n#qvdswwztfw .gt_center {\n  text-align: center;\n}\n\n#qvdswwztfw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#qvdswwztfw .gt_font_normal {\n  font-weight: normal;\n}\n\n#qvdswwztfw .gt_font_bold {\n  font-weight: bold;\n}\n\n#qvdswwztfw .gt_font_italic {\n  font-style: italic;\n}\n\n#qvdswwztfw .gt_super {\n  font-size: 65%;\n}\n\n#qvdswwztfw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#qvdswwztfw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#qvdswwztfw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#qvdswwztfw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#qvdswwztfw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#qvdswwztfw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#qvdswwztfw .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#qvdswwztfw .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#qvdswwztfw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"3\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Population par sexe en 2019</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Sexe\">Sexe</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Effectif\">Effectif</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Pourcentage\">Pourcentage</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Sexe\" class=\"gt_row gt_left\">Femmes</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 146 436</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">52.9</td></tr>\n    <tr><td headers=\"Sexe\" class=\"gt_row gt_left\">Hommes</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 019 195</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">47.1</td></tr>\n    <tr><td headers=\"Sexe\" class=\"gt_row gt_left\">Total</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">2 165 631</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">100.0</td></tr>\n  </tbody>\n  <tfoot>\n    <tr class=\"gt_sourcenotes\">\n      <td class=\"gt_sourcenote\" colspan=\"3\">Source : Insee, RP 2019 ; Champ : Paris.</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\nOn a gagné 5 lignes de codes !   \n\nSi on a plusieurs filtres à mettre, comme on a pu le voir avec le 2nd tableau, on peut utiliser l'argument \"...\" (lire \"dot\") : cet argument est très pratique si l'on ne sait pas combien il y aura de variable(s) dans la fonction à laquelle elle s'applique, c'est-à-dire autant 0 variable, 1 variable ou plus d'une variable ; mais elle peut aussi être \"dangereuse\" si on ne se souvient plus qu'on l'a créée et/ou si on ne fait pas attention à bien remplir les autres arguments avec les noms correspondants. Si on réécrit la fonction tableau et qu'on l'applique au 2nd tableau créé précédemment, cela donnerait ceci : \n\n::: {.cell}\n\n```{.r .cell-code}\ntableau <- function(data, ..., var_quali, pond=IPONDI, nom_var_quali){\n  \n  tab <- data %>% \n    filter(...) %>% \n    count({{ var_quali }}, wt={{ pond }}) %>% \n    mutate(Pourcentage=round(prop.table(n)*100, 1)) %>% \n    adorn_totals(\"row\") %>% \n    rename(Effectif=n, {{nom_var_quali}}:={{ var_quali }}) \n  \n  return(tab)\n  \n}\n\nRP_final %>% \n  mutate(TACT_moda=case_when(TACT == \"11\" ~ \"Actifs ayant un emploi\",\n                             TACT == \"12\" ~ \"Chômeurs\",\n                             TACT == \"22\" ~ \"Élèves, étudiants et stagiaires non rémunérés\",\n                             TACT == \"21\" ~ \"Retraités ou préretraités\",\n                             TRUE ~ \"Autres inactifs\"),\n         TACT_moda=fct_relevel(TACT_moda, c(\"Actifs ayant un emploi\", \"Chômeurs\",\n                                            \"Élèves, étudiants et stagiaires non rémunérés\", \n                                            \"Retraités ou préretraités\", \"Autres inactifs\"))) %>% \n  tableau(DEPT == \"75\" & !AGEREVQ %in% c(\"0\", \"5\", \"10\", \"65\", \"70\", \"75\", \"80\", \"85\", \"90\", \"95\", \n                                        \"100\", \"105\", \"110\", \"115\", \"120\"),\n          var_quali=TACT_moda, nom_var_quali=\"Type d'activité\") %>% \n  gt() %>% \n  fmt_number(columns = 2, sep_mark = \" \", decimals = 0) %>% \n  tab_header(title = \"Population de 15-64 ans par type d'activité en 2019\") %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"hmrfduvwge\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#hmrfduvwge table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#hmrfduvwge thead, #hmrfduvwge tbody, #hmrfduvwge tfoot, #hmrfduvwge tr, #hmrfduvwge td, #hmrfduvwge th {\n  border-style: none;\n}\n\n#hmrfduvwge p {\n  margin: 0;\n  padding: 0;\n}\n\n#hmrfduvwge .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#hmrfduvwge .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#hmrfduvwge .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#hmrfduvwge .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#hmrfduvwge .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#hmrfduvwge .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#hmrfduvwge .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#hmrfduvwge .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#hmrfduvwge .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#hmrfduvwge .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#hmrfduvwge .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#hmrfduvwge .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#hmrfduvwge .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#hmrfduvwge .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#hmrfduvwge .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmrfduvwge .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#hmrfduvwge .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#hmrfduvwge .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#hmrfduvwge .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmrfduvwge .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#hmrfduvwge .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmrfduvwge .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#hmrfduvwge .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmrfduvwge .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hmrfduvwge .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmrfduvwge .gt_left {\n  text-align: left;\n}\n\n#hmrfduvwge .gt_center {\n  text-align: center;\n}\n\n#hmrfduvwge .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#hmrfduvwge .gt_font_normal {\n  font-weight: normal;\n}\n\n#hmrfduvwge .gt_font_bold {\n  font-weight: bold;\n}\n\n#hmrfduvwge .gt_font_italic {\n  font-style: italic;\n}\n\n#hmrfduvwge .gt_super {\n  font-size: 65%;\n}\n\n#hmrfduvwge .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#hmrfduvwge .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#hmrfduvwge .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#hmrfduvwge .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#hmrfduvwge .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#hmrfduvwge .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#hmrfduvwge .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#hmrfduvwge .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#hmrfduvwge div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"3\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Population de 15-64 ans par type d'activité en 2019</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Type-d'activité\">Type d'activité</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Effectif\">Effectif</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Pourcentage\">Pourcentage</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Actifs ayant un emploi</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 042 588</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">69.3</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Chômeurs</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">135 014</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">9.0</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Élèves, étudiants et stagiaires non rémunérés</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">192 205</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">12.8</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Retraités ou préretraités</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">38 512</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">2.6</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Autres inactifs</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">95 944</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">6.4</td></tr>\n    <tr><td headers=\"Type d'activité\" class=\"gt_row gt_center\">Total</td>\n<td headers=\"Effectif\" class=\"gt_row gt_right\">1 504 263</td>\n<td headers=\"Pourcentage\" class=\"gt_row gt_right\">100.1</td></tr>\n  </tbody>\n  <tfoot>\n    <tr class=\"gt_sourcenotes\">\n      <td class=\"gt_sourcenote\" colspan=\"3\">Source : Insee, RP 2019 ; Champ : Paris.</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n   \n   \nUne autre façon de faire serait de créer un vecteur qui contiendrait ces différents filtres mais qu'il faudrait combiner dans une chaîne de caractères, ce qui est possible avec la fonction `paste0()`, et l'insérer ensuite dans la ligne de code `dplir` en utilisant `eval(parse(text=))` pour convertir cette chaîne de caractéres en une expression (`parse(text=)`) pour que `R` puisse l'évaluer/le calculer avec la fonction `eval()`.\n\n::: {.cell}\n\n```{.r .cell-code}\ntableau_bis <- function(data, vars_filtre, var_quali, pond=IPONDI, nom_var_quali){\n\n  text_filtre <- paste0(\"(\", vars_filtre, \")\", collapse = \" & \")\n\n  tab1 <- data %>%\n    filter(eval(parse(text = text_filtre))) %>%\n    count({{ var_quali }}, wt={{ pond }}) %>%\n    mutate(Pourcentage=round(prop.table(n)*100, 1)) %>%\n    adorn_totals(\"row\") %>%\n    rename(Effectif=n, {{nom_var_quali}}:={{ var_quali }}) \n\n  return(tab1)\n\n}\n\n# Attention, comme les filtres sont contenues dans des \" \", il faut à l'intérieur des  \n#  filtres utiliser les ' ' plutôt que les \" \"\nmes_filtres <- c(\"DEPT == '75'\", \"!AGEREVQ %in% c('0', '5', '10', '65', '70', '75', \n                                                  '80', '85', '90', '95', '100', '105',\n                                                  '110', '115', '120')\")\n\nRP_final %>% \n  mutate(TACT_moda=case_when(TACT == \"11\" ~ \"Actifs ayant un emploi\",\n                             TACT == \"12\" ~ \"Chômeurs\",\n                             TACT == \"22\" ~ \"Élèves, étudiants et stagiaires non rémunérés\",\n                             TACT == \"21\" ~ \"Retraités ou préretraités\",\n                             TRUE ~ \"Autres inactifs\"),\n         TACT_moda=fct_relevel(TACT_moda1, c(\"Actifs ayant un emploi\", \"Chômeurs\",\n                                            \"Élèves, étudiants et stagiaires non rémunérés\", \n                                            \"Retraités ou préretraités\", \"Autres inactifs\"))) %>% \n  tableau_bis(mes_filtres, var_quali=TACT_moda, nom_var_quali=\"Type d'activité\") %>%\n  gt() %>%\n  fmt_number(columns = 2, sep_mark = \" \", decimals = 0) %>% \n  tab_header(title = \"Population de 15-64 ans par type d'activité en 2019\") %>% \n  tab_source_note(source_note = \"Source : Insee, RP 2019 ; Champ : Paris.\")\n```\n:::\n\n   \nOn peut également créer une fonction pour permettre de récupérer plus rapidement les libellés des variables à partir du fichier de métadonnées :\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pour la fonction mutate, on est de nouveau obligé d'utiliser l'expression \n#  'eval(parse(text={{ cod_var }}))' sinon R ne comprend pas que la variable \n#  utilisée est une expression de type caractère\nlibelles_var <- function(data, cod_var, new_var){\n  \n  levels_var <- meta[meta$COD_VAR=={{ cod_var }}, ]$COD_MOD\n  labels_var <- meta[meta$COD_VAR=={{ cod_var }}, ]$LIB_MOD\n  data %>% mutate({{ new_var }} := factor(eval(parse(text={{ cod_var }})), \n                                          levels = levels_var, labels = labels_var))\n\n}\n\n\n# Autre possibilité, utiliser la fonction `sym()` (qui crée un symbole à partir \n# d'une chaîne de caractères) avec les \"!!\" (opérateur bang-bang qui permet de \n# forcer l'évaluation d'une partie d'une expression avant le reste) : \n\n# libelles_var <- function(data, cod_var, new_var){\n#   \n#   levels_var <- meta[meta$COD_VAR=={{ cod_var }}, ]$COD_MOD\n#   labels_var <- meta[meta$COD_VAR=={{ cod_var }}, ]$LIB_MOD\n#   data %>% mutate({{ new_var }} := factor(!!sym({{ cod_var }}), \n#                                           levels = levels_var, \n#                                           labels = labels_var))\n#   \n# }\n```\n:::\n\n\n\nEnfin, essayez d'écrire une seconde fonction `somme()` permettant de systématiser le code utilisée en fin de 1ère séance et qui donnait un tableau de contingence du nombre de personnes caractériées par son statut par commune (cela nous servira pour plus tard...) ; le voici pour rappel : \n\n::: {.cell}\n\n```{.r .cell-code}\nRP_final %>% \n  group_by(COM) %>%\n  count(TACT, wt=IPONDI) %>% \n  mutate(n=round(n)) %>% \n  pivot_wider(names_from = TACT, values_from = n)\n```\n:::\n\n\n<div class=\"solution-exo\">\n\n::: {.cell}\n\n```{.r .cell-code}\nsomme <- function(data, var_gpe, nom_var){\n  \n  som <- data %>% \n    group_by({{var_gpe}}) %>% \n    count({{nom_var}}, wt=IPONDI) %>% \n    mutate(n=round(n)) %>% \n    pivot_wider(names_from = {{nom_var}}, values_from = n)\n  \n  return(som)\n  \n}\n```\n:::\n\n</div>\n\\fi \n\nVérifions :\n\n::: {.cell}\n\n```{.r .cell-code}\nsomme(data=RP_final, COM, TACT)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 137 × 8\n# Groups:   COM [137]\n   COM    `11`  `12`  `21`  `22`  `23`  `24`  `25`\n   <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n 1 75101  8366   941  2630  1423  1628   252   676\n 2 75102 13118  1378  2148  1617  2499   272   576\n 3 75103 19239  2085  4589  2947  3630   446  1100\n 4 75104 15227  1863  4508  2764  3268   480  1000\n 5 75105 27378  2611 10607  9138  6189   923  1369\n 6 75106 18073  1842  8180  6326  3742  1097  1012\n 7 75107 23394  2165  9573  5659  5312  1652  1112\n 8 75108 18254  1565  5297  3999  4693  1063   779\n 9 75109 34155  3482  7264  5201  7656   892  1377\n10 75110 46454  6343 10645  7083 11481  1241  3273\n# ℹ 127 more rows\n```\n\n\n:::\n:::\n\n\n\nLa création de fonctions est donc très utile pour avoir un code plus efficace ; il faut toutefois réfléchir à son usage avant de la créer pour savoir à quel point il faut systématiser les procédures utilisées, certains éléments devant être laissés probablement en-dehors de la fonction, comme dans l'exemple précédent le fait d'arrondir les chiffres. Il faut par ailleurs toujours vérfier, sur un ou deux exemples, que la fonction fonctionne bien, c'est-à-dire donne les mêmes résultats que le code initial.  \n\nPour pouvoir les réutiliser ultérieurement, on peut les réécrire dans un nouveau script qu'on enregistre dans un dossier de notre projet qu'on intitule \"fonctions\" ; il suffira ensuite d'appeler ce programme avec la fonction `source()` :\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"fonctions/fonctions.R\")\n```\n:::\n\n\n\n\n   ",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}