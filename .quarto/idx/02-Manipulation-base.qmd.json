{"title":"Manipulation de la base","markdown":{"headingText":"Manipulation de la base","headingAttr":{"id":"sec-manipulation-base","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r message=FALSE, warning=FALSE, include=FALSE}\n# Chargement des librairies\nlibrary(tidyverse)\nlibrary(gt)\n\n# Chargement des tables\nRP <- readRDS(file =\"data/indiv2019.Rdata\") \nmeta <- readRDS(file=\"data/meta.Rdata\")\n```\n\nOn peut maintenant regarder à quoi ressemble la table principale, celle des données.\n\n```{r}\nRP %>% head() %>% gt()\n```\n\nLa fonction `str()` ou son équivalent en langage `dplyr` la fonction `glimpse` nous donne la liste des variables avec cette fois leur format et leurs modalités (les premières seulement s'il y en a beaucoup).\n\n```{r}\n# str(RP)\nRP %>% glimpse()\n```\n\nLes variables sont en format, soit 'int' (\"integer\" - nombres entiers), soit 'fct' (\"factor\"), ou encore 'dbl' (\"double\" - nombres réels). On remarque que la plupart des variables ont des modalités en chiffres et/ou lettres, ce qui signifie qu'il faudra probablement recoder ces modalités pour leur donner des libellés dans nos analyses descriptives (tableaux ou graphiques).\n\nPar ailleurs, certaines variables ont été laissées en format 'integer' bien que l'on avait mis l'option `stringsAsFactors=TRUE` lors du chargement des données, or ces chiffres correspondent bien à des modalités d'une variable catégorielle, il faudra donc le corriger ultérieurement.\n\nDernière remarque, si on avait eu des valeurs manquantes sur certaines variables, elles se seraient ici affichées avec la modalité `NA`, cela ne semble pas le cas, à vérifier par la suite. En revanche, on voit parfois des modalités \"z\" ou \"zz\", il faudra vérifier ce qu'elles indiquent.\n\n## Format des données - WIDE ou LONG\n\nLa question du **format de la table de données** est importante, on distingue généralement le format *wide* du format *long* :\n\n-   le premier renvoie au cas où chaque ligne correspond a un et un seul individu (ou autre niveau de l'analyse : une entreprise, un ménage, un logement, etc.), et toutes les informations le concernant sont données en colonnes (ce qui peut augmenter rapidement le nombre de colonnes), c'est l'exemple d'une information que l'on a sur plusieurs années, chaque colonne correspondant à l'information de l'année en question ;\n-   le second, au contraire, multiplie les lignes pour un seul individu, mais il y a alors moins de colonnes, à partir du même exemple précédent, il y aura cette fois une colonne indiquant l'année et une colonne contenant l'information.\n\nIci, chaque ligne correspond à un **individu** auquel est associé un **logement**, un **ménage** ou encore une **famille** ; on est bien dans un format `wide`. L'unité statistique de base est donc l'individu, mais on peut vouloir choisir de se mettre au niveau logement ou ménage ou famille, pour étudier les caractéristiques de ces unités. Autre exemple, on peut aussi considérer que notre niveau d'analyse est la commune, on verra alors qu'on dispose de plusieurs lignes par commune et si l'on veut garder quelques informations à ce niveau en n'ayant plus qu'une ligne par commune, il faudra sommer ces informations.\n\nLe package `tidyverse` contient deux fonctions qui permettent de passer d'un format à un autre : `pivot_longer()` et `pivot_wider()` présentés en détails <a href=\"https://tidyr.tidyverse.org/articles/pivot.html\" target=\"_blank\">ici</a>. Nous aurons l'occasion de les utiliser ultérieurement dans ce cours.\n\n## Sélectionner un champ réduit de la base, séparer les données\n\nManipuler une base de données, c'est aussi travailler ou créer une table réduite, surtout quand on a des données volumineuses comme ici : c'est donc choisir un champ particulier de la base.\n\nOn peut par exemple choisir un champ géographique plus réduit au sein de l'Île-de-France, à partir de la commune : Paris et sa petite couronne.\n\nOn peut aussi choisir de séparer les données en créant 2 tables selon l'unité statistique : l'individu ; ou le logement avec la seule personne de référence du ménage.\n\nComme vous le savez très probablement, dans le langage `tidyverse`, pour faire des sélections sur les lignes ou observations dans une table de données, on utilise la fonction `filter()` ; pour faire des sélections sur les colonnes ou variables, on utilise la fonction `select()` ; pour supprimer des variables, on utilise également `select()` avec un \"-\" devant la (ou les) variable(s) à supprimer (dans le langage `R` de base, on peut aussi utiliser la fonction `subset()`).\n\n**EXERCICES** : Créer trois nouvelles bases selon les indications suivantes :\n\n-   la première que vous nommerez \"RP_Paris\" et qui rassemblera les données pour le seul département de Paris ;\n-   la deuxième que nous nommerez \"RP_indiv\" et qui comprendra les données pour les seules variables décrivant l'individu (et ce sera celle de la personne de référence du ménage) ;\n-   la troisième que vous nommerez \"RP_final\", qui rassemblera les données pour les départements de Paris et de sa petite couronne, et qui comprendra toutes les variables décrivant l'individu, le logement et enfin les variables géographiques.\n\n<!-- Les premières lignes de ces trois tables devront ressembler à cela : -->\n\n```{r exo1, echo=FALSE, include=FALSE}\nRP_Paris <- RP %>% filter(DEPT == \"75\")\n\nRP_indiv <- RP %>% select(\"AEMMR\", \"AGED\", \"AGER20\", \"AGEREV\",\"AGEREVQ\",\"ANAI\",\n                          \"ANEMR\",\"APAF\",\"COUPLE\",\"CS1\",\"DIPL\",\"DNAI\",\"EMPL\",\n                          \"ETUD\",\"ILETUD\",\"ILT\",\"IMMI\",\"INAI\",\"INATC\",\"IPONDI\",\n                          \"IRAN\",\"LPRF\",\"LPRM\",\"MOCO\",\"MODV\",\"NA17\",\n                          \"NA5\",\"NAIDT\",\"ORIDT\",\"RECH\",\"SEXE\",\"STAT_CONJ\",\n                          \"STATR\",\"TACT\",\"TACTD16\",\"TP\",\"TRANS\")\n  \nRP_final  <- RP %>% filter(DEPT %in% c(\"75\",\"92\",\"93\",\"94\")) %>% \n                        select(-c(\"NUMMI\",\"INPERF\",\"DEROU\",\"LIENF\",\"INFAM\",\n                                  \"NE17FR\",\"INPER\",\t\"NE24FR\",\"NPERR\",\t\"NE3FR\",\n                                  \"SFM\",\t\"NE5FR\", \"TYPMC\",\t\"NENFR\",\"TYPMR\",\n                                  \"NUMF\",\"VOIT\",\t\"TYPFC\"))\nRP_Paris %>% head(4) %>% gt()\nRP_indiv %>% head(4) %>% gt()\nRP_final%>% head(4) %>% gt()\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n\n```{r exo1-sol, eval=FALSE}\nRP_Paris <- RP %>% filter(DEPT == \"75\")\n\nRP_indiv <- RP %>% select(\"AEMMR\", \"AGED\", \"AGER20\", \"AGEREV\",\"AGEREVQ\",\"ANAI\",\n                          \"ANEMR\",\"APAF\",\"COUPLE\",\"CS1\",\"DIPL\",\"DNAI\",\"EMPL\",\n                          \"ETUD\",\"ILETUD\",\"ILT\",\"IMMI\",\"INAI\",\"INATC\",\"IPONDI\",\n                          \"IRAN\",\"LPRF\",\"LPRM\",\"MOCO\",\"MODV\",\"NA17\",\n                          \"NA5\",\"NAIDT\",\"ORIDT\",\"RECH\",\"SEXE\",\"STAT_CONJ\",\n                          \"STATR\",\"TACT\",\"TACTD16\",\"TP\",\"TRANS\")\n  \nRP_final  <- RP %>% filter(DEPT %in% c(\"75\",\"92\",\"93\",\"94\")) %>% \n                        select(-c(\"NUMMI\",\"INPERF\",\"DEROU\",\"LIENF\",\"INFAM\",\n                                  \"NE17FR\",\"INPER\",\t\"NE24FR\",\"NPERR\",\t\"NE3FR\",\n                                  \"SFM\",\t\"NE5FR\", \"TYPMC\",\t\"NENFR\",\"TYPMR\",\n                                  \"NUMF\",\"VOIT\",\t\"TYPFC\"))\n```\n:::\n\n```{r eval=FALSE, include=FALSE}\n# Par exemple pour les 2 premières bases avec \"subset\":\nRP_Paris <- subset(RP, DEPT == \"75\")\nRP_indiv <- subset(RP, select=c(\"AEMMR\", \"AGED\", \"AGER20\", \"AGEREV\",\"AGEREVQ\",\n                                \"ANAI\", \"ANEMR\",\"APAF\",\"COUPLE\",\"CS1\",\"DIPL\",\n                                \"DNAI\",\"EMPL\",\"ETUD\",\"ILETUD\",\"ILT\",\"IMMI\",\n                                \"INAI\",\"INATC\",\"IPONDI\",\"IRAN\",\"LPRF\",\"LPRM\",\n                                \"MOCO\",\"MODV\",\"NA17\",\"NA5\",\"NAIDT\",\"ORIDT\",\n                                \"RECH\",\"SEXE\",\"STAT_CONJ\",\"STATR\",\"TACT\",\n                                \"TACTD16\",\"TP\",\"TRANS\"))\n```\n\n\nOn va dorénavant travailler sur cette dernière table `RP_final`, on l'enregistre donc dans notre dossier \"data\", ainsi que le fichier `meta` que nous avons modifié précédemments :\n\n```{r eval=FALSE}\n# Enregistrement des fichiers\nsaveRDS(object = RP_final , file = \"data/RP_final.Rdata\") \nsaveRDS(object = meta, file = \"data/meta.Rdata\")\n```\n\n```{r include=FALSE}\n# Suppression du fichier RP trop lourd\nrm(RP)\n# Appel de la table RP_final\nRP_final <- readRDS(file =\"data/RP_final.Rdata\") \nmeta <- readRDS(file =\"data/meta.Rdata\")\n#RP <- readRDS(file =\"data/indiv2019.Rdata\") \n```\n","srcMarkdownNoYaml":""},"formats":{"bookup-html":{"identifier":{"display-name":"HTML","target-format":"bookup-html","base-format":"html","extension-name":"bookup"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"shortcodes":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"filters":["F:\\Enseignements\\Enseignements Univ. Paris Cite 2020-xx\\Data Mining_M2 PISE\\Cours 2023-2025\\Data-Mining-2025\\_extensions\\juba\\bookup\\embed-fonts.lua"],"toc-depth":3,"output-file":"02-Manipulation-base.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.26","embed-fonts":true,"theme":{"light":["_extensions/juba/bookup/bookup.scss"],"dark":["_extensions/juba/bookup/bookup.scss","_extensions/juba/bookup/bookup_dark.scss"]},"revealjs-plugins":[],"toc-title":"Sur cette page"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["bookup-html"]}