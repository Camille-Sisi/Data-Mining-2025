{"title":"Les applications interactives avec Shiny App","markdown":{"headingText":"Les applications interactives avec Shiny App","headingAttr":{"id":"sec-Intro-a-Shiny-theorique","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\nComme indiqué sur la page officielle de Shiny-RStudio <a href=\"https://shiny.posit.co/\" target=\"_blank\">ici</a>, Shiny est un package R qui permet de créer des applications ou des pages web de visualisations interactives de données, directement à partir de R, autremet dit sans connaître nécessairement le langage HTML, Javascript, etc., et donc aussi en pouvant utiliser toutes les fonctions disponibles sous R. En réalité, l'interface utilisateur de l'application Shiny est bien du langage HTML, mais Shiny donne des outils faciles pour l'écrire sans avoir à connaître le HTML.\n\nIl nous faut d'abord installer le package **`Shiny`**, puis le charger :\n\n```{r warning=FALSE, message=FALSE}\n#install.packages(\"shiny\")\nlibrary(shiny)\n```\n\nDes exemples d'application Shiny sont données sur la page officielle dans la <a href=\"https://shiny.posit.co/r/gallery/\" target=\"_blank\">galerie</a> ; ou on peut aussi en lancer une directement dans R, avec par exemple le code suivant :\n\n```{r eval=FALSE}\n# Voici la liste des exemples que vous pouvez spécifier dans la fonction \n# suivante : \"01_hello\", \"02_text\", \"03_reactivity\", \"04_mpg\", \n# \"05_sliders\", \"06_tabsets\", \"07_widgets\", \"08_html\", \"09_upload\",\n# \"10_download\", \"11_timer\"\nrunExample(\"01_hello\")\nrunExample(\"05_sliders\")\n```\n\nUn autre exemple d'application finale qui comprend un aspect territorial donc avec de jolis cartes, et qui s'appuie sur les données du Recensement de la population (rassemblées par l'Insee sur la période 1968-2019 et qui forme la base Saphir), est disponible <a href=\"https://francestrategie.shinyapps.io/app_seg/\" target=\"_blank\">ici</a> .\n\nEnfin, cette introduction s'appuie sur d'autres ressources externes, pour n'en citer que quelques uns : - un bon tutoriel <a href=\"https://deanattali.com/blog/building-shiny-apps-tutorial/\" target=\"_blank\">ici</a> ; - une introduction claire <a href=\"https://laderast.github.io/gradual_shiny/introduction.html\" target=\"_blank\">là</a>. Et vous trouverez sur les 2 liens suivants deux ouvrages en ligne, pour compléter et aller plus loin : the <a href=\"https://mastering-shiny.org/index.html\" target=\"_blank\">Mastering Shiny</a> ; et the <a href=\"https://plotly-r.com/\" target=\"_blank\">Interactive web-based data visualization with R, plotly, and shiny</a>.\n\n## La structure générale d'une application Shiny\n\nL’application est divisée en 2 sections : l’**interface utilisateur** (**ui**) et une **fonction serveur** (**server**). L’intérêt de Shiny est sa réactivité : quand l’utilisateur change un paramètre, tout ce qui dépend de ce paramètre est automatiquement actualisé sur la page. On dit que c'est une application \"server-based\", dans la mesure où la construction des graphiques et/ou tableaux affichés (ou tout autre objet) se font sur le serveur, autrement dit sur le RStudio de votre ordinateur.\\\nAinsi, comme on peut le voir sur les exemples cités au-dessus, la structure du code sera toujours la suivante :\n\n```{r eval=FALSE}\nlibrary(shiny)\n\n# Fonction \"ui\"\nui <- fluidPage(\n                )\n\n# Fonction \"server\"\nserver <- function(input, output) {\n  \n                   }\n\n# Fonction qui crée l'application Shiny en reprenant les 2 fonctions \n# principales. A noter que comme elles ont le même nom, souvent on ne \n# précisera pas de nouveau les arguments \"ui = \" et \"server = \"\nshinyApp(ui = ui, server = server)\n\n```\n\n### La partie \"UI\"\n\nL'**`UI`** ou \"interface utilisateur\" utilise par défaut la fonction **`fluidPage()`** qui permet de créer la mise en page de l’application et qui répondra automatiquement aux changements effectués sur le navigateur par l'utilisateur.\\\nCette fonction `fluidPage()` va contenir des indications comme le titre (avec **`titlePanel()`**), éventuellement un sous-titre, etc., ainsi que deux fonctions **`sidebarLayout()`** et **`mainPanel()`**.\\\nLe première comprend la fonction `sidebarPanel()` qui contient le ou les \"widgets\" à partir duquel ou desquels les utilisateurs sélectionneront des valeurs – par défaut est indiqué un `sliderInput()`. La seconde contient la sortie voulue, c’est-à-dire un graphique, un tableau, etc., avec par défaut la fonction `plotOutput()`, mais elle peut en contenir d’autres... Les graphiques ou tableaux de ces fonctions `...Ouput()` sont ensuite précisées (et construits) dans la partie \"**Server**\" de l’application Shiny.\n\n```{r eval=FALSE}\n#library(shiny)\n\n# Fonction \"ui\"\nui <- fluidPage(\n  # Titre de l'application\n  titlePanel(\"Titre à définir\"),\n  \n  # Mise en page de la barre latérale avec les définitions des \n  # entrées et des sorties\n  sidebarLayout(\n    \n    # Panneau latéral pour les entrées\n    sidebarPanel(\n      \n      # Entrée : wigdet choisi, par défaut \"sliderInput()\"\n      sliderInput(\n        \n      )\n      \n    ),\n    # Panneau principal pour l'affichage des sorties\n    mainPanel(\n      # Sortie : graphique, tableau, etc.\n      plotOutput(\"nom_du_graphe\")\n      )\n    )\n  )\n\n# Fonction \"server\"\nserver <- function(input, output) {\n  \n                   }\n\n# Fonction qui crée l'application Shiny\nshinyApp(ui = ui, server = server)\n\n```\n\nLa liste des widgets est reproduite ci-dessous avec un tableau et une image récapitulative (disponible directement <a href=\"https://shiny.rstudio.com/gallery/widget-gallery.html\" target=\"_blank\">ici</a>) ; à part les arguments communs `inputID()` et `label()`, les autres arguments diffèrent selon le widget, il est donc essentiel d’y faire un tour avant d’en utiliser un si l’on ne le connaît pas *a priori*.\n\n| Fonction | Widget |\n|:-----------------------------------|:-----------------------------------|\n| sliderInput | Barre de défilement |\n| actionButton | Bouton d'action |\n| checkboxGroupInput | Groupe de cases à cocher |\n| checkboxInput | Case unique à cocher |\n| dateInput | calendrier pour sélectionner une ou des dates |\n| dateRangeInput | Paire de calendriers pour sélectionner une plage de dates |\n| numericInput | Champ pour saisir des chiffres |\n| radioButtons | Série de boutons radio |\n| selectInput | Boîte avec des choix à sélectionner |\n| submitButton | Bouton de validation |\n| fileInput | Commande pour télécharger un fichier à partir d'un chemin |\n| textInput | Champ pour saisir du texte |\n| helpText | Texte d'aide qui peut être ajouté à un formulaire de saisie |\n\n: **Tableau : Fonctions Shiny et widgets associés**\n\n**Widgets de l'application Shiny**\n\n![](images/Liste%20Widgets%20Shiny.png)\n\nD'autres interfaces utilisateur existent. Par exemple, avec le package **`bslib`**, on peut utiliser la fonction `page_sidebar()` à la place de `fluidPage()`, comme ceci :\n\n```{r eval=FALSE}\n#library(shiny)\nlibrary(bslib)\n\n# Fonction \"ui\"\nui <- page_sidebar(\n  \n  title = \"Titre à définir\",\n  \n  sidebar = sidebar(\"Barre latéral\"),\n  \n  \"Contenu principal\",\n\n  mainPanel(\n      # Sortie : graphique, tableau, etc.\n      plotOutput(\"nom_du_graphe\")\n      )\n)\n\n# Fonction \"server\"\nserver <- function(input, output) {\n  \n                   }\n\n# Fonction qui crée l'application Shiny\nshinyApp(ui = ui, server = server)\n\n```\n\nOu encore la fonction `navbarPage()` pour permettre plusieurs onglets de navigation sur la même page web (que l'on créera avec la fonction `tabPanel()` à l'intérieur de laquelle on retrouvera les fonctions `sidebarPanel()` et `mainPanel()`) :\n\n```{r eval=FALSE}\n\n# Fonction \"server\"\nui <- navbarPage(\n\n  title=\"Titre à définir\",\n  \n  tabPanel(title = \"Graphique\",\n           fluidPage(\n             sidebarLayout(\n               sidebarPanel(\n                 # sliderInput(\n                 #    )\n                 ),\n               mainPanel(\n                 plotOutput(\"nom_du_graphe\")\n                 )             \n               )\n           )\n           ),\n  \n  tabPanel(\"Résumé des variables\"),\n  \n  tabPanel(\"Tableau\"),\n   \n    )\n\n# Fonction \"server\"\nserver <- function(input, output) {\n  \n                   }\n\n# Fonction qui crée l'application Shiny\nshinyApp(ui = ui, server = server)\n```\n\n### La partie \"Server\"\n\nC’est la fonction **`Server`** qui contient le code principal faisant tourner l’application web.\\\nElle est définie par la fonction `function(input, output){ }`. À chaque fonction `...Ouput()` dans l'**ui** correspond une fonction `render...()` dans la partie **`Server`**. Par exemple, si dans la partie **`ui`**, on a définit un histogramme comme ceci dans la fonction : `plotOuput(\"distPlot\")`, alors dans la partie **`server`**, on associera la fonction `renderPlot()` à `output$distPlot`. Les fonctions `render...()` sont celles qui contiennent en effet le code créant, l’histogramme ici, ou tout autre graphique ou tableau, l’ensemble de l’expression à l'intérieur de cette fonction sera contenu dans des accolades `{}`.\n\n```{r eval=FALSE}\n#library(shiny)\n\n# Fonction \"ui\"\nui <- fluidPage(\n    # Titre de l'application\n  titlePanel(\"Titre à définir\"),\n  \n  # Mise en page de la barre latérale avec les définitions des \n  # entrées et des sorties\n  sidebarLayout(\n    \n    # Panneau latéral pour les entrées\n    sidebarPanel(\n      \n      # Entrée : wigdet choisi, par défaut \"sliderInput()\"\n      sliderInput(\n        \n      )\n      \n      ),\n    \n    # Panneau principal pour l'affichage des sorties\n    mainPanel(\n      # Sortie : graphique, tableau, etc.\n      plotOutput(\"nom_du_graphe\")\n      )\n    \n    )\n  \n  )\n\n# Fonction \"server\"\nserver <- function(input, output) {\n  \n  # Reprend la sortie mentionnée plus haut (ici \"nom_du_graphe\")\n  output$nom_du_graphe <- renderPlot({\n    \n    # code de création du graphique, qui sera réactive selon les \n    # valeurs données en entrées (cf. fonction \"fluidPage()\")\n    \n  })\n                   }\n\n# Fonction qui crée l'application Shiny\nshinyApp(ui = ui, server = server)\n\n```\n\nVoici les différentes fonctions `...Ouput()` créant un objet de sortie :\n\n| Fonction de sortie | Type d'objet créé |\n|:-------------------|:------------------|\n| dataTableOutput    | Table de données  |\n| imageOutput        | Image             |\n| plotOutput         | Graphique         |\n| tableOutput        | Table             |\n| textOutput         | Texte             |\n| uiOutput           | HTML brut         |\n| htmlOutput         | HTML brut         |\n| verbatimTextOutput | Texte             |\n\nEt les fonctions `render...()` associées :\n\n| Fonction de sortie | Type d'objet créé |\n|:------------------------------------|:----------------------------------|\n| renderDataTable | Table de données |\n| renderImage | Image (enregistré comme un lien vers un fichier source) |\n| renderPlot | Graphique |\n| renderTable | Table de données, matrices, ou autres structures de type tableau |\n| renderText | Texte sous forme de chaînes de caractères |\n| renderUI | objet de balise Shiny ou HTML |\n| renderPrint | Toute sortie imprimée |\n\n## La réactivité\n\nComme dit précédemment, la réactivité est au centre du fonctionnement d'une application Shiny. Plusieurs types de réactivité peut être distingués :\n\n-   un *premier type de réactivité*, le plus simple, à travers les interactions entre les fonctions **`ui()`** et **`server()`** : comme expliqué au-dessus, cela passe par les \"input\" définis dans la partie **ui** et les \"output\" créés dans la partie **server** ; plus précisément, si on a définit un widget permettant par exemple de choisir une année donnée et qu'on l'a appelé `annee` (avec l'argument `id=\" \"`), alors dans la ou les fonctions `render...()` de la partie **server**, il faudra renvoyer à cette variable par l'indication `input$annee`. De manière générale, il faudra accoler le nom donné à un input `x` de cette façon dans le **server** : `input$x`.\\\n    Cela peut être résumé par le schéma suivant, emprunté à l'une des sources citées en introduction :\n\n![](images/Reactivite%20UI%20et%20SERVER.png)\n\n*Source : https://laderast.github.io/gradual_shiny/introduction.html*\n\n-   un *deuxième type de réactivité à travers la base de données elle-même*, c'est-à-dire qui crée un objet réactif (qui sera à la fois une entrée réactive et une sortie réactive) : il faut alors utiliser, par exemple, la fonction `reactive({})` (ou son corrolaire `eventReactive()`) en l'appliquant à la base de données initiale et en renvoyant ainsi une nouvelle base, qui sera elle-même une fonction. On peut par exemple appliquer un filtre à notre base de données selon l'année : au lieu alors de préciser `input$annee` dans la fonction `render...()` comme mentionné dans le premier type de réactivité, on va en réalité créer une nouvelle base comme ceci : `data_reactive <- reactive({ data %>% filter(annee > input$annee)) })` ; puis l'appeler ainsi pour créer le graphique : `output$nom_du_graphe <- renderPlot({ data_reactive() })`, attention vous noterez l'utilisation des parenthèses après le nouveau nom de la table. De même, cela peut être résumé par le schéma suivant tiré de la même source :\n\n![](images/Reactivite%20base%20de%20donnees.png)\n\n*Source : https://laderast.github.io/gradual_shiny/app-2-reactives.html*\n\n-   un *troisième type de réactivité qui crée un contexte réactif*, à travers notamment la fonction `observe({})` (ou son corrolaire `observeEvent()`) : cette fonction sera utilisée losque vous souhaitez faire une opération qui dépend de plusieurs autres variables réactives, en particulier si vous souhaitez changer un input qui est dépendant d'un autre input, mais sans créer nécessairement d'output. Cela peut être utile si le choix d'une variable - les départements d'une région par exemple - est conditionnée au choix antérieur de la région en question : dans ce cas, l'utilisateur qui choisira une région dans un premier widget ne verra s'afficher que les départements de cette région dans un second widget et non tous les départements disponibles dans la base de données.\n\nIl y a bien d'autres fonctions de réactivité dans Shiny : `eventReactive()`, `observeEvent()`, `reactiveValues()`, `isolate()`, `req()`, mais qu'on ne présentera pas forcément en détails dans ce cours mais que vous pourrez utiliser dans votre application finale.\n\n## Un exemple avec le code du script par défaut\n\nVoyons ensemble un premier exemple : dans **RStudio**, ouvrez un nouveau fichier \"Shiny Web App...\" que vous intitulez comme vous le souhaitez (attention, pas d'espace permis entre deux mots par exemple), vous laissez l'option \"Single File\" et vous l'enregistrez de préférence dans votre projet.\\\nUn nouveau scrip s'ouvre avec par défaut un code minimal déjà écrit : on retrouve la structure du code présentée juste au-dessus, et à l'intérieur de l'UI et du Server quelques codes pour avoir un titre, un widget sous forme de \"slider\" et un graphique qui sera un histogramme d'après la fonction écrit dans la partie Server. Faisons tourner l'application avec le bouton en haut à droite \"Run App\" pour voir ce que cela donne ! On voit bien les différents éléments correspondants au code écrit dans le script R et on voit bien également que l'application est interactive puisque si l'on modifie le nombre de classes dans la barre slider, le graphique est modifié alors simultanément !\n","srcMarkdownNoYaml":""},"formats":{"bookup-html":{"identifier":{"display-name":"HTML","target-format":"bookup-html","base-format":"html","extension-name":"bookup"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"shortcodes":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"filters":["F:\\Enseignements\\Enseignements Univ. Paris Cite 2020-xx\\Data Mining_M2 PISE\\Cours 2023-2025\\Data-Mining-2025\\_extensions\\juba\\bookup\\embed-fonts.lua"],"toc-depth":3,"output-file":"09-Intro-a-Shiny-theorique.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.26","embed-fonts":true,"theme":{"light":["_extensions/juba/bookup/bookup.scss"],"dark":["_extensions/juba/bookup/bookup.scss","_extensions/juba/bookup/bookup_dark.scss"]},"revealjs-plugins":[],"toc-title":"Sur cette page"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["bookup-html"]}