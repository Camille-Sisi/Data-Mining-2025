{"title":"Récupération de la base de données","markdown":{"headingText":"Récupération de la base de données","headingAttr":{"id":"sec-base-donnees","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\nOn va travailler cette année sur les données du Recensement de la Population (RP). C'est une base de données riche en informations, qui s'appuie sur les enquêtes annuelles du recensement et est produite par l'Insee. Les fichiers mis à disposition sur leur site sont au nombre de 9 : ils rassemblent des informations différentes, sur des espaces géographiques différents (canton ou ville, région), et à des niveaux d'analyse différents (individus, ménages/logements). Les derniers fichiers disponibles portent sur l'année 2021 mais nous allons travailer sur l'année 2019 qui rassemble les enquêtes annuelles du recensement (EAR) des années 2017 à 2021.\n\nAvant de rentrer plus dans les détails, on va charger les librairies principales que l'on va utiliser lors de cette séance (si elles ne sont pas installées sur votre RStudio, il faut le faire avant en utilisant la commande `install.packages(\"nom.du.package\")`, on pourra en appeler d'autres dans les deux sections suivantes.\n\n```{r message=FALSE, warning=FALSE}\n# Chargement des librairies\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(gt)\n```\n\n## Les données du Recensement de la Population (RP)\n\n```{r include=FALSE}\nRP <- readRDS(file =\"data/indiv2019.Rdata\") \nmeta <- readRDS(file=\"data/meta.Rdata\")\n```\n\nOn va travailler plus précisément à partir du fichier \"Individus localisés au canton-ou-ville\" qui décrit les caractéristiques des individus et celles des ménages qui les occupent. Les données sont localisées au niveau de la commune et de l'IRIS. On ne va pas s'intéresser à l'ensemble de la France, pour des questions d'intérêt et d'analyse, ainsi que des questions pratiques (ces fichiers étant lourds). On va donc télécharger uniquement ce fichier pour la zone A, c'est-à-dire l'Île-de-France.\n\nLe mieux est de télécharger le fichier puis le dézipper directement dans `R` comme ci-dessous en copiant le lien URL sur le site de l'Insee ; et on le stock dans le dossier \"data\" de notre projet `R`. Sinon, il reste possible de le télécharger *via* internet et de l'enregistrer dans un de vos dossiers bien spécifiés pour le \"dézipper\" ensuite.\n\n```{r eval=FALSE}\ndownload.file(url=\"https://www.insee.fr/fr/statistiques/fichier/6544333/RP2019_INDCVIZA_csv.zip\",\n              destfile = \"data/RP2019_INDCVIZA_csv.zip\")\n\n# Le fichier a donc été téléchargé dans le dossier intitulé \"data\" du projet R, on va\n# maintenant le dézipper et enregistrer les fichiers extraits dans le même dossier.\nunzip(\"data/RP2019_INDCVIZA_csv.zip\", exdir = \"data\")\n\n```\n\nIl nous reste plus qu'à charger les données dans notre environnement RStudio : pour cela on utilise la commande `fread` du package **`data.table`** (à installer avant), car cela va bien plus vite que les fonctions habituelles du type `read.csv` lorsqu'on a de gros fichiers. On indique également l'option `stringsAsFactors=TRUE` pour que les variables caractères soient directement transformées en variables \"factor\" (dont l'utilité est indéniable dans `R`, on en reparlera plus loin), et on transforme l'objet obtenu en `data.frame`.\n\n```{r eval=FALSE}\n# install.packages(\"data.table\")\nlibrary(data.table)\nRP <- fread(\"data/FD_INDCVIZA_2019.csv\", stringsAsFactors=TRUE)\nRP <- as.data.frame(RP)\n```\n\nOn a donc `r ncol(RP)` variables et `r format(nrow(RP), big.mark=\" \")` observations.\n\nPour se renseigner sur les variables de la table, on peut télécharger également le fichier des métadonnées avec la commande `read.csv` cette fois, ce qui nous permet de voir quelles options sont utiles ici : l'argument `sep =` nous permet d'indiquer comment sont séparées les informations dans le fichier initial, l'argument `encoding =` permet que les accents aigus soient compris par `R` comme tel, et enfin la même option `stringsAsFactors=TRUE` peut être utilisée ici.\n\n```{r eval=FALSE}\n# Lecture du fichier de métadonnées\nmeta <- read.csv(file = 'data/Varmod_INDCVI_2019.csv',\n                 sep = \";\",\n                 encoding = \"UTF-8\",\n                 stringsAsFactors = TRUE)\n```\n\nOn peut enregistrer ce fichier, ainsi que celui contenant les métadonnées, dans le dossier `R` au format RDS.\n\n```{r  eval=FALSE}\n# Enregistrement des fichiers\nsaveRDS(object = RP, file = \"data/indiv2019.Rdata\")\nsaveRDS(object = meta, file = \"data/meta.Rdata\")\n```\n\n## Quelles informations intéressantes dans cette base ?\n\nOn peut regarder plus précisément les variables disponibles dans cette base de données à partir de la table de métadonnées : on peut le faire avec la fonction `view()` et dans ce cas la table s'affichera dans un nouvel onglet dans votre RStudio ; sinon pour l'afficher sur notre document notebook, on peut utiliser la fonction `head()` et/ou `tail()` qui affiche respectivement les premières lignes et les dernières lignes de la table.\n\n```{r}\n# view(meta)\nmeta %>% head() %>% gt() #La fonction gt() permet un affichage plus joli pour le document html\n```\n\nOn peut établir la liste des variables de la base de données en utilisant la fonction `levels` qui donne les niveaux de la variable \"COD_VAR\" puisque c'est une variable 'factor'.\n\n```{r}\nlevels(meta$COD_VAR) \n```\n\nLes codes des variables n'étant pas très parlant, on va les afficher avec leur intitulé : pour cela, il suffit de repartir de la table `meta` en sélectionnant les 2 colonnes qui nous intéressent et en n'affichant pas les valeurs dupliquées avec la fonction `unique()`.\n\n```{r}\nmeta %>% select(COD_VAR, LIB_VAR) %>% unique() %>% gt()\n```\n\nOu si on veut les afficher par ordre alphabétique selon le nom de la variable, on peut utiliser la fonction `arrange()` qui permet de trier une table de données selon la variable indiquée :\n\n```{r eval=FALSE}\nmeta %>% select(COD_VAR, LIB_VAR) %>% unique() %>% arrange(COD_VAR) %>% gt()\n```\n\nL'une des difficultés pour l'analyse de cette base de données réside dans les différents niveaux présents : \"individu\" pour la personne de référence du ménage ; \"ménage\" regroupant l'ensemble des occupants d'une résidence principale, qu'ils aient ou non des liens de parenté ; \"famille\" partie d'un ménage comprenant au moins 2 personnes (par exemple, un couple, ou un adulte avec un enfant...) ; et enfin \"logement\" qui comprend ici les résidences principales et rassemble des informations décrivant les types de logement.\n\nIl faut bien comprendre comment utiliser à bon escient ces différents niveaux, en particulier ici le niveau logement : pour toute variable de ce niveau, il faudra utiliser un filtre, c'est-à-dire ne prendre que la personne de référence du ménage (`LPRM==\"1\"`).\n\nIl faut également penser que les données sont pondérées, donc pour sortir des statistiques descriptives, il faut à chaque fois mettre la variable de pondération `IPONDI`.\n","srcMarkdownNoYaml":""},"formats":{"bookup-html":{"identifier":{"display-name":"HTML","target-format":"bookup-html","base-format":"html","extension-name":"bookup"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"shortcodes":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"filters":["F:\\Enseignements\\Enseignements Univ. Paris Cite 2020-xx\\Data Mining_M2 PISE\\Cours 2023-2025\\Data-Mining-2025\\_extensions\\juba\\bookup\\embed-fonts.lua"],"toc-depth":3,"output-file":"01-Base-de-donnees.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.26","embed-fonts":true,"theme":{"light":["_extensions/juba/bookup/bookup.scss"],"dark":["_extensions/juba/bookup/bookup.scss","_extensions/juba/bookup/bookup_dark.scss"]},"revealjs-plugins":[],"toc-title":"Sur cette page"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["bookup-html"]}